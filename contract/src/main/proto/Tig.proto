syntax = "proto3";
package tig.grpc.contract;
import "google/protobuf/empty.proto";


service TigService {
  rpc register(LoginRequest) returns (StatusReply);
  rpc login(LoginRequest) returns (LoginReply);
  rpc logout(SessionRequest) returns (google.protobuf.Empty);
  rpc uploadFile(stream FileChunk) returns (StatusReply);
  rpc editFile(stream FileChunk) returns (StatusReply);
  rpc deleteFile(FileRequest) returns (StatusReply);
  rpc accessControlFile(OperationRequest) returns (StatusReply);
  rpc downloadFile(FileRequest) returns (stream FileChunk);
  rpc listFiles(SessionRequest) returns (ListFilesReply);
}

// LOGIN OPERATION
message LoginRequest {
  string username = 1;
  string password = 2;
}

message LoginReply {
  StatusCode code = 1;
  string sessionId = 2;
}


message SessionRequest {
  string sessionId = 1;
}

// FILE STREAM OPERATION
message FileChunk {
  bytes content = 1;
  string sessionId = 2;
  string fileName = 3;
  string owner = 4;
  int32 permission = 5;
  int32 sequence = 6;
}

message StatusReply {
  StatusCode code = 1;
}

enum StatusCode {
  UNKNOWN = 0;
  OK = 1;
  FAILED = 2;
}

//FILE OPERATION
message FileRequest {
  string sessionId = 1;
  string fileName = 2;
  string owner = 3;
  int32 permission = 4;
}

//ACCESS CONTROL OPERATION
message OperationRequest {
  string sessionId = 1;
  string fileName = 2;
  string owner = 3;
  int32 permission = 4;
  OperationEnum operation = 5;
}

enum OperationEnum {
  PUBLIC = 0;
  PRIVATE = 1;
}

//LIST FILES
message ListFilesReply {
  repeated string fileInfo = 1;
}